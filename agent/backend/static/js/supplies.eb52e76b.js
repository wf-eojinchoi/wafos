(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["supplies"],{"5fbe":function(t,s,a){t.exports=a.p+"img/logo2.88467ec1.png"},"679c":function(t,s,a){t.exports=a.p+"img/card.e18f66c7.png"},"6ac2":function(t,s,a){"use strict";var e=a("a9d4"),n=a.n(e);n.a},"7da8":function(t,s,a){"use strict";a.r(s);var e=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("v-layout",{attrs:{wrap:""}},[e("v-flex",{attrs:{xs12:""}},[e("v-stepper",{staticClass:"wt-stepper elevation-0",attrs:{"alt-labels":""},model:{value:t.steps,callback:function(s){t.steps=s},expression:"steps"}},[e("v-stepper-header",[e("v-stepper-step",{staticClass:"single-stepper",class:"ko"!=t.$i18n.locale?"title":t.$store.getters.isV2?"headline":"display-1",attrs:{complete:!0,step:"1"}},[t._v(t._s(t.$t("supplies.step1.title")))])],1),e("v-stepper-items",[e("v-stepper-content",{attrs:{step:"1"}},[e("step1",{attrs:{supply:t.supply,dialog:t.dialog},on:{"update:supply":function(s){t.supply=s},"update:dialog":function(s){t.dialog=s}}}),e("v-layout",{attrs:{"justify-space-between":""}},[e("v-flex",{staticClass:"text-xs-center",attrs:{xs3:""}},[e("v-btn",{staticClass:"wt-prev-bg white--text wt-btn",class:t.$store.getters.isV2?"display-1":"display-2",attrs:{flat:"",round:""}},[t._v(t._s(t.$t("app.prev")))])],1),e("v-flex",{staticClass:"text-xs-center",attrs:{xs3:""}},[e("img",{staticClass:"wt-bottom-logo",attrs:{src:a("5fbe")}})]),e("v-flex",{attrs:{xs3:""}})],1)],1)],1)],1)],1),e("v-dialog",{attrs:{lazy:"",persistent:t.paymentSteps>=5},model:{value:t.dialog,callback:function(s){t.dialog=s},expression:"dialog"}},[e("v-card",{attrs:{height:"800px"}},[e("v-card-title",[e("v-spacer"),t.paymentSteps<5?e("v-btn",{attrs:{flat:"",icon:""},on:{click:function(s){t.dialog=!1,t.paymentSteps=1}}},[e("v-icon",{staticClass:"fa fa-times fa-4x"})],1):t._e()],1),e("v-card-text",[1===t.paymentSteps?e("v-layout",{attrs:{wrap:"","justify-center":"","align-center":"","mt-5":""}},[e("v-flex",{staticClass:"text-xs-center",attrs:{xs12:"","mt-5":""}},[e("p",[e("span",{staticClass:"display-2 wt-primary-font"},[t._v(t._s(t.supply.title))]),e("span",{staticClass:"display-2"},[t._v("("+t._s(t.supply.description)+")")]),e("br"),e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("payment.desc2-3")))]),e("br"),e("br"),e("span",{directives:[{name:"show",rawName:"v-show",value:!t.canPayment(),expression:"!canPayment()"}],staticClass:"display-2 mt-5",attrs:{"mt-3":""}},[t._v('\n                "'+t._s(t.$t("payment.cant-payment"))+'"\n              ')])])]),e("v-flex",{staticClass:"text-xs-center mt-5",attrs:{xs6:""}},[e("v-btn",{staticClass:"display-2 wt-wave-bg wt-btn white--text py-5",attrs:{round:"",disabled:!t.canPayment()},on:{click:function(s){t.$store.state.user.hasOwnProperty("phone")?t.trigger():t.paymentSteps=2}}},[t.canPayment()?e("span",[t._v(t._s(t.$t("app.buy")))]):e("span",[t._v(t._s(t.$t("payment.no-payment")))])])],1)],1):2===t.paymentSteps?e("v-layout",{attrs:{wrap:"","justify-center":"","align-center":"","mt-5":""}},[e("v-flex",{staticClass:"text-xs-center",attrs:{xs12:""}},[e("p",[e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("payment.way")))])])]),e("v-flex",{staticClass:"text-xs-center mt-5",attrs:{xs6:""}},[e("v-btn",{staticClass:"display-3 huge-btn white--text",attrs:{color:"#ea68a2",round:""},on:{click:function(s){t.paymentSteps=4,t.payment="cash"}}},[e("p",[e("img",{attrs:{src:a("e6da")}}),e("br"),e("span",[t._v(t._s(t.$t("payment.cash")))])])])],1),e("v-flex",{staticClass:"text-xs-center mt-5",attrs:{xs6:""}},[e("v-btn",{directives:[{name:"show",rawName:"v-show",value:!0===t.$store.state.agency.menu_card,expression:"$store.state.agency.menu_card === true"}],staticClass:"display-3 huge-btn white--text",attrs:{color:"#ea68a2",round:""},on:{click:function(s){t.paymentSteps=3,t.payment="card"}}},[e("p",[e("img",{attrs:{src:a("679c")}}),e("br"),e("span",[t._v(t._s(t.$t("payment.card")))])])])],1)],1):3===t.paymentSteps?e("v-layout",{attrs:{wrap:"","justify-center":"","align-center":"","mt-5":""}},[e("v-flex",{staticClass:"text-xs-center",attrs:{xs12:"","mb-5":""}},[e("p",[e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("payment.desc5")))])])]),t._l(t.prices,function(s){return e("v-flex",{key:s,staticClass:"text-xs-center mt-1",attrs:{xs5:""}},[e("v-btn",{staticClass:"display-1 wt-payment-btn",attrs:{round:""},on:{click:function(a){t.paymentSteps=4,t.paymentPrice=s}}},[e("span",[t._v(t._s(s)+" "+t._s(t.$t("app.money-unit")))])])],1)})],2):4===t.paymentSteps&&"ko"===t.$i18n.locale?e("v-layout",{attrs:{wrap:"","justify-center":"","align-center":"","mt-5":""}},[e("v-flex",{staticClass:"text-xs-left",attrs:{xs8:""}},[e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("payment.product-price"))+": ")]),e("span",{staticClass:"display-2 wt-primary-font"},[t._v(t._s(t.supply.amount))]),e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("app.money-unit")))])]),"card"===t.payment?e("v-flex",{staticClass:"text-xs-left",attrs:{xs8:"","mt-3":""}},[e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("payment.payment-price"))+": ")]),e("span",{staticClass:"display-2 wt-primary-font"},[t._v(t._s(t.paymentPrice))]),e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("app.point-unit")))])]):t._e(),e("v-flex",{staticClass:"text-xs-left",attrs:{xs9:"","my-2":""}},[e("v-divider")],1),e("v-flex",{staticClass:"text-xs-left",attrs:{xs8:"","mt-3":""}},[e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("payment.total-saved-money"))+": ")]),e("span",{staticClass:"display-2 wt-primary-font"},[t._v("0")]),e("span",{staticClass:"display-2"},[t._v("\n              "+t._s(t.$t("app.money-unit"))+"\n              "),e("br"),t._v("\n              "+t._s(t.$t("payment.cant-save"))+"\n            ")])]),e("v-flex",{staticClass:"text-xs-center",attrs:{xs6:"","mt-4":""}},[e("v-btn",{staticClass:"display-2 wt-wave-bg wt-btn white--text py-5",attrs:{round:"",disabled:"card"===t.payment&&t.paymentPrice<t.supply.amount},on:{click:function(s){t.requestPayment(),t.paymentSteps=5}}},["card"===t.payment?e("span",[t._v(t._s(t.$t("payment.card")))]):e("span",[t._v(t._s(t.$t("payment.cash")))])])],1)],1):4===t.paymentSteps&&"ko"!==t.$i18n.locale?e("v-layout",{attrs:{wrap:"","justify-center":"","align-center":"","mt-5":""}},[e("v-flex",{staticClass:"text-xs-left",attrs:{xs8:""}},[e("span",{staticClass:"display-1"},[t._v(t._s(t.$t("payment.product-price"))+": ")]),e("span",{staticClass:"display-1 wt-primary-font"},[t._v(t._s(t.supply.amount))]),e("span",{staticClass:"display-1"},[t._v(t._s(t.$t("app.money-unit")))])]),"card"===t.payment?e("v-flex",{staticClass:"text-xs-left",attrs:{xs8:"","mt-3":""}},[e("span",{staticClass:"display-1"},[t._v(t._s(t.$t("payment.payment-price"))+": ")]),e("span",{staticClass:"display-1 wt-primary-font"},[t._v(t._s(t.paymentPrice))]),e("span",{staticClass:"display-1"},[t._v(t._s(t.$t("app.point-unit")))])]):t._e(),e("v-flex",{staticClass:"text-xs-left",attrs:{xs9:"","my-2":""}},[e("v-divider")],1),e("v-flex",{staticClass:"text-xs-left",attrs:{xs8:"","mt-3":""}},[e("span",{staticClass:"display-1"},[t._v(t._s(t.$t("payment.total-saved-money"))+": ")]),t.$store.state.user.hasOwnProperty("phone")?[e("span",{staticClass:"display-1 wt-primary-font"},[t._v(t._s(t.paymentPrice-t.supply.amount))]),e("span",{staticClass:"display-1"},[t._v(t._s(t.$t("app.money-unit")))])]:[e("span",{staticClass:"display-1 wt-primary-font"},[t._v("0")]),e("span",{staticClass:"display-1"},[t._v("\n                "+t._s(t.$t("app.money-unit"))+"\n                "),e("br"),t._v("\n                "+t._s(t.$t("payment.cant-save"))+"\n              ")])]],2),e("v-flex",{staticClass:"text-xs-center",attrs:{xs6:"","mt-4":""}},[e("v-btn",{staticClass:"display-1 wt-wave-bg wt-btn white--text py-5",attrs:{round:"",disabled:"card"===t.payment&&t.paymentPrice<t.supply.amount},on:{click:function(s){t.requestPayment(),t.paymentSteps=5}}},["card"===t.payment?e("span",[t._v(t._s(t.$t("payment.card")))]):e("span",[t._v(t._s(t.$t("payment.cash")))])])],1)],1):5===t.paymentSteps?e("v-layout",{attrs:{wrap:"","justify-center":"","align-center":"","mt-5":""}},["cash"===t.payment?e("v-flex",{staticClass:"text-xs-left",attrs:{xs8:"","mt-3":""}},[e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("payment.cash-warning")))])]):t._e(),e("v-flex",{staticClass:"text-xs-left",attrs:{xs8:"","mt-3":""}},[e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("payment.payment-price"))+": ")]),e("span",{staticClass:"display-2 wt-primary-font"},[t._v(t._s(t.supply.amount))]),e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("app.money-unit")))])]),e("v-flex",{staticClass:"text-xs-left",attrs:{xs8:"","mt-3":""}},[e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("payment.insert-money"))+": ")]),e("span",{staticClass:"display-2 wt-primary-font"},[t._v(t._s(t.insertMoney))]),e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("app.money-unit")))])]),e("v-flex",{staticClass:"text-xs-left",attrs:{xs8:"","mt-3":""}},[e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("payment.limit-time"))+": ")]),e("span",{staticClass:"display-2 wt-primary-font"},[t._v(t._s(120-t.insertCount))]),e("span",{staticClass:"display-2"},[t._v(t._s(t.$t("app.second")))])])],1):6===t.paymentSteps?e("v-layout",{attrs:{wrap:"","justify-center":"","align-center":"","mt-5":""}},[e("v-flex",{staticClass:"text-xs-center",attrs:{xs8:"","mt-3":""}},[e("span",{staticClass:"display-1"},[t._v(t._s(t.$t("payment.failure")))])]),e("v-flex",{staticClass:"text-xs-center",attrs:{xs8:"","mt-3":""}},[e("span",{staticClass:"display-1"},[t._v(t._s(t.$t("payment.close")))])])],1):7===t.paymentSteps?e("v-layout",{attrs:{wrap:"","justify-center":"","align-center":"","mt-5":""}},[e("v-flex",{staticClass:"text-xs-center",attrs:{xs8:"","mt-3":""}},[e("span",{staticClass:"display-1"},[t._v(t._s(t.$t("payment.supply-success")))])]),e("v-flex",{staticClass:"text-xs-center",attrs:{xs8:"","mt-3":""}},[e("span",{staticClass:"display-1"},[t._v(t._s(t.$t("payment.close")))])])],1):t._e()],1)],1)],1)],1)},n=[],i=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("v-card",{staticClass:"mb-5 elevation-0",attrs:{height:"640px"}},[a("v-layout",{attrs:{wrap:"","justify-center":"","fill-height":""}},[a("v-flex",{attrs:{xs10:""}},[a("v-layout",{attrs:{wrap:"","justify-center":"","align-center":""}},["ko"===t.$i18n.locale?a("v-flex",{staticClass:"text-xs-center",attrs:{xs12:""}},[a("span",{staticClass:"display-2"},[t._v(t._s(t.$t("supplies.step1.desc1"))+" ")]),a("span",{staticClass:"display-2 font-weight-bold wt-primary-font"},[t._v(t._s(t.$t("supplies.step1.desc2")))]),a("span",{staticClass:"display-2"},[t._v(t._s(t.$t("supplies.step1.desc3")))])]):a("v-flex",{staticClass:"text-xs-center",attrs:{xs12:""}},[a("span",{staticClass:"display-1"},[t._v(t._s(t.$t("supplies.step1.desc1"))+" ")]),a("span",{staticClass:"display-1"},[t._v(t._s(t.$t("supplies.step1.desc2"))+" ")]),a("span",{staticClass:"display-1"},[t._v(t._s(t.$t("supplies.step1.desc3")))])]),t._l(t.currentItems,function(s){return a("v-flex",{key:s.id,staticClass:"text-xs-center",attrs:{xs6:""}},[a("v-btn",{staticClass:"supply ma-0 pa-0",class:s.id===t.supply.id?"selected-supply":"not-selected-supply",attrs:{flat:"",top:""},on:{click:function(a){return t.selectSupply(s.id)}}},[a("v-layout",{attrs:{wrap:"","ma-0":"","pa-0":""}},[a("v-flex",{attrs:{xs12:"","mt-5":""}},["ko"===t.$i18n.locale?a("span",{staticClass:"display-1"},[t._v(t._s(s.title))]):"en"===t.$i18n.locale?a("span",{staticClass:"title"},[t._v(t._s(s.title_en))]):"vi"===t.$i18n.locale?a("span",{staticClass:"title"},[t._v(t._s(s.title_vn))]):t._e()]),a("v-flex",{attrs:{xs12:"","mt-3":"","mb-2":""}},[a("span",{staticClass:"display-2"},[t._v(t._s(s.amount))])]),a("v-flex",{attrs:{xs12:"","mt-4":""}},["ko"===t.$i18n.locale?a("span",{staticClass:"headline black--text"},[t._v(t._s(s.description))]):"en"===t.$i18n.locale?a("span",{staticClass:"headline black--text"},[t._v(t._s(s.description_en))]):"vi"===t.$i18n.locale?a("span",{staticClass:"headline black--text"},[t._v(t._s(s.description_vn))]):t._e()])],1)],1)],1)})],2)],1)],1)],1)},p=[],l={name:"SuppliesStep1",components:{},props:{supply:{type:Object,default:Object},dialog:{type:Boolean,default:!1}},computed:{maxPage:function(){return this.items?parseInt(this.items.length%4===0?this.items.length/4-1:this.items.length/4):0},currentItems:function(){return this.items?this.items.slice(4*this.page,4*(this.page+1)):[]}},data:function(){return{page:0,items:[]}},mounted:function(){this.$store.state.devices.supplies[0]&&(this.items=this.$store.state.devices.supplies[0].courses)},methods:{selectSupply:function(t){var s=this.items.find(function(s){return s.id===t});s&&(this.$emit("update:supply",s),this.$emit("update:dialog",!0))},nextPage:function(){this.page<this.maxPage&&(this.page+=1)},prevPage:function(){this.page>0&&(this.page-=1)},hasPages:function(){return this.maxPage>0}}},r=l,c=(a("a2e1"),a("2877")),o=Object(c["a"])(r,i,p,!1,null,"75c926e4",null),y=o.exports,m={name:"Supplies",components:{Step1:y},data:function(){return{supply:{},steps:1,count:1,dialog:!1,payment:null,paymentSteps:1,paymentPrice:0,prices:[1e3,5e3,1e4,2e4,3e4,4e4,5e4],interval:null,insertMoney:0,insertCount:0}},destroyed:function(){this.clearDialog(),this.interval&&clearInterval(this.interval)},methods:{canPayment:function(){if(!this.$store.state.user.hasOwnProperty("phone"))return!0;if(0!==this.$store.state.agency.use_point&&this.$store.state.user.point>=this.$store.state.agency.use_point){if(this.$store.state.user.point+this.$store.state.user.money>=this.supply.amount)return!0}else if(this.$store.state.user.money>=this.supply.amount)return!0;return!1},trigger:function(){var t=this;if(this.$store.commit("statePause",!0),this.interval&&clearInterval(this.interval),this.insertMoney<this.paymentPrice)return this.paymentSteps=6,void setTimeout(this.clearDialog,2e3);var s=this.$store.state.devices.supplies[0].controller_id;console.log("Supplies",s),this.$axios.post("/trigger",{price:this.supply.amount,target:s}).then(function(s){if(t.$store.state.user.hasOwnProperty("phone")){var a=0,e=0;if(a=t.$store.state.user.point<t.$store.state.agency.use_point?0:t.$store.state.user.point>=t.supply.amount?t.supply.amount:t.$store.state.user.point,!(t.$store.state.user.money>=t.supply.amount-a))return t.paymentSteps=6,void setTimeout(t.clearDialog,2e3);e=t.supply.amount-a,t.$store.state.user.point-=a,t.$store.state.user.money-=e,t.$axios.post("/server",{method:"POST",path:"/payment",args:{agency_id:t.$store.state.agency.id,member_id:t.$store.state.user.id,amount:e,use_point:a,pay_type:3,device_type:6}})}else console.log("then3"),t.$axios.post("/server",{method:"POST",path:"/payment",args:{agency_id:t.$store.state.agency.id,member_id:0,amount:t.insertMoney,pay_type:"cash"===t.payment?0:2,device_type:6}});t.paymentSteps=7,setTimeout(function(){this.$router.push("/first"),this.clearDialog()}.bind(t),5e3)}).catch(function(s){console.log(s),t.paymentSteps=6,setTimeout(t.clearDialog,2e3)})},clearDialog:function(){this.$store.commit("stateNoAction",60),this.$store.commit("statePause",!1),this.dialog=!1,this.paymentSteps=1,this.paymentPrice=0,this.insertMoney=0,this.insertCount=0},requestPayment:function(){var t=this;this.$store.commit("statePause",!0),"cash"===this.payment?(this.$axios.post("/cash/call").then(function(s){t.insertMoney=s.data.money}).catch(function(s){t.interval&&clearInterval(t.interval),t.$socket.emit("cancel-payment")}),this.interval=setInterval(function(){var t=this;this.$axios.get("/cash/status").then(function(s){s.data.money>=t.supply.amount?(t.trigger(),t.$socket.emit("cancel-payment")):(s.data.money&&(t.insertMoney=s.data.money),s.data.t&&(t.insertCount=s.data.t))}).catch(function(t){})}.bind(this),500)):"card"===this.payment&&(this.$axios.post("/card/call",{money:this.paymentPrice}).then(function(s){t.insertMoney=s.data.money,t.trigger()}).catch(function(t){}).finally(function(){t.interval&&clearInterval(t.interval)}),this.interval=setInterval(function(){var t=this;this.$axios.get("/card/status").then(function(s){s.data.money<t.paymentPrice&&(s.data.money&&(t.insertMoney=s.data.money),s.data.t&&(t.insertCount=s.data.t))}).catch(function(t){})}.bind(this),500))}}},u=m,v=(a("6ac2"),Object(c["a"])(u,e,n,!1,null,"a72237d4",null));s["default"]=v.exports},a2e1:function(t,s,a){"use strict";var e=a("beee"),n=a.n(e);n.a},a9d4:function(t,s,a){},beee:function(t,s,a){},e6da:function(t,s,a){t.exports=a.p+"img/cash.b45b4be8.png"}}]);
//# sourceMappingURL=supplies.eb52e76b.js.map